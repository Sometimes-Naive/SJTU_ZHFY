{% extends 'layout.html' %}
{% load static %}
{% block head %}
<div class="item header">收结案预测</div>


{% endblock %}
{% block column1 %}
<div class="ui  centered grid" style="height: 90%;background-color: #ffffff"  >
    {% block sjayc_date %}
{#    <div class="row" style="height: 98%;background-color: #ffffff" >#}
        <div class="column" style="width: 25%;height:100%;background-color: #ffffff">

            <div class="ui segment container row" style="height: 40%;background-color: #ffffff" id="chart1"></div>
            <div class="ui segment container row" style="height: 80%;background-color: #ffffff" >
                <div class="ui segment container row" style="height: 50%" id="chart2">

                </div>
                <div class="ui segment container row" style="height: 50%;">
                        <table class="ui celled table">
                          <thead>
                            <tr><th>区县名称</th>
                            <th>司法特征指标</th>

                          </tr></thead>
                          <tbody>
                            <tr>
                              <td data-label="名称">万州区</td>
                              <td data-label="指标">XXX</td>

                            </tr>
                            <tr>
                              <td data-label="名称">渝中区</td>
                              <td data-label="指标">XXX</td>

                            </tr>
                            <tr>
                              <td data-label="名称">九龙坡区</td>
                              <td data-label="指标">XXX</td>

                            </tr>
                          <tr>
                              <td data-label="名称">XX区</td>
                              <td data-label="指标">XXX</td>

                            </tr>

                          </tbody>
                        </table>
                </div>
            </div>
        </div>

        <div class="column" style="width: 40%;height:100%;background-color: #ffffff">
            <div class="ui segment container row" style="height: 71%;background-color: #ffffff" id="chart3"></div>
            <div class="ui two column grid container" style="width:100%;height: 49%;background-color: #ffffff" id="chart4">
                <div class=" ui segment container column" style="width: 49%;height: 100%;margin: 1em 0 0 0;" id="chart4-1">
                        aa
                </div>
                <div class="ui segment container column" style="width: 49%;height: 100%;" id="chart4-2">
                        asa
                </div>
            </div>
        </div>
        <div class="column" style="width: 35%;height:100%;background-color: #ffffff">

            <div class="ui segment container row" style="height: 60%;background-color: #ffffff" >
                <div class="ui segment container row" style="height: 49%" id="chart5-1">

                </div>
                <div class="ui segment container row" style="height: 49%" id="chart5-2">

                </div>
            </div>
            <div class="ui segment container row" style="height: 60%;background-color: #ffffff" >
                <div class="ui  container row" style="height: 65%;background-color: #ffffff" id="chart6"></div>
                <div class=" ui container row" style="margin: 0 0 0 0;padding: 0 0 0 0 " id="chart6-1">
            <div class="ui selection dropdown">地区
              <input type="hidden" name="地区" style="width: 80%">
              <i class="dropdown icon"></i>
              <div class="text"><i class="world icon" ></i>请选择</div>
              <div class="menu">
                <a class="item" href="javascript:void(0);" onclick="line_chart_dynamic({{ test.line_data.0|safe }});prediction('#chart6-2',{{ test.line_data.0 }});$('#chart6-3').text('具体建议:'+'{{ advice.0 |safe }}')"><i class="world icon"></i>{{ test.region.0 }}</a>
                <a class="item" href="javascript:void(0);" onclick="line_chart_dynamic({{ test.line_data.1|safe }});prediction('#chart6-2',{{ test.line_data.1 }});$('#chart6-3').text('具体建议:'+'{{ advice.1 |safe }}')"><i class="world icon"></i>{{ test.region.1 }}</a>
                <a class="item" href="javascript:void(0);" onclick="line_chart_dynamic({{ test.line_data.2|safe }});prediction('#chart6-2',{{ test.line_data.2 }});$('#chart6-3').text('具体建议:'+'{{ advice.2 |safe }}')"><i class="world icon"></i>{{ test.region.2 }}</a>
                <a class="item" href="javascript:void(0);" onclick="line_chart_dynamic({{ test.line_data.3|safe }});prediction('#chart6-2',{{ test.line_data.3 }});$('#chart6-3').text('具体建议:'+'{{ advice.3 |safe }}')"><i class="world icon"></i>{{ test.region.3 }}</a>
                   <a class="item" href="javascript:void(0);" onclick="line_chart_dynamic({{ test.line_data.4|safe }});prediction('#chart6-2',{{ test.line_data.4 }});$('#chart6-3').text('具体建议:'+'{{ advice.4 |safe }}')"><i class="world icon"></i>{{ test.region.4 }}</a>
                <a class="item" href="javascript:void(0);" onclick="line_chart_dynamic({{ test.line_data.5|safe }});prediction('#chart6-2',{{ test.line_data.5 }});$('#chart6-3').text('具体建议:'+'{{ advice.5 |safe }}')"><i class="world icon"></i>{{ test.region.5 }}</a>
                <a class="item" href="javascript:void(0);" onclick="line_chart_dynamic({{ test.line_data.6|safe }});prediction('#chart6-2',{{ test.line_data.6 }});$('#chart6-3').text('具体建议:'+'{{ advice.6 |safe }}')"><i class="world icon"></i>{{ test.region.6 }}</a>
            </div>
        </div>
            </div>
            <div class="ui  two column grid container" style="height: 33%;background-color: #ffffff;padding: 2em 0;" >

                <div class=" column" style="width: 30%;height: 100%;margin: 0 0 0 0; vertical-align: middle" id="chart6-2">预测结果
            </div>
                <div class=" column" style="width: 69%;height: 100%;margin: 0 0 0.5em 0;" id="chart6-3">具体建议
            </div>
            </div>

        </div>
{#    </div>#}

    {% endblock %}



</div>

{% endblock %}

{% block jschart %}
    <script src="{% static 'js/variable-pie.js' %}"></script>
    <script>

    //热力图函数,得到地图数据,show sa_number and ja_number of every region at last month
    function functiondate(map_data){
            //function1(date_data);
            //function2(date_data);
            $.getJSON('https://data.jianshukeji.com/jsonp?filename=geochina/chongqing.json&callback=?', map_data, function(mapdata) {
                    var data = map_data;
                    map1 = new Highcharts.Map('chart3', {
                        title: {
                            text: '最新一个月重庆各地区收结案数量'
                        },
                        mapNavigation: {
                            enabled: true,
                            buttonOptions: {
                                verticalAlign: 'bottom'
                            }
                        },
                                  credits:{
                                        enabled:false,
                                    },
                                    exporting:{
                                        enabled:false,
                                    },
                        colorAxis: {
                            min: 0,
                            minColor: '#fff',
                            maxColor: '#006cee',
                            labels:{
                                style:{
                                    "color":"red","fontWeight":"bold"
                                }
                            }
                        },
                        series: [{
                            data: data,
                            mapData: mapdata,
                            joinBy: 'name',
                            name: '重庆市地图'
                        }]
                    });
                });
        }
    functiondate({{ map_data|safe }})
    </script>
    <script>
    function pie_chart(){
        Highcharts.chart('chart1', {
    chart: {
        type: 'variablepie'
    },
    title: {
        text: '司法资源分配'
    },
    credits:{
            enabled:false
    },
    exporting:{
    enabled:false,
    },
    tooltip: {
        headerFormat: '',
        pointFormat: '<span style="color:{point.color}">\u25CF</span> <b> {point.name}</b><br/>' +
        '指标数值: <b>{point.y}</b><br/>' +
        '指标比重: <b>{point.z}</b><br/>'
    },
    series: [{
        minPointSize: 10,
        innerSize: '20%',
        zMin: 0,
        name: 'countries',
        data: {{ pie_data | safe }}
    }]
});
    }
    function his_chart(chart_name,title_name) {
        var chart = Highcharts.chart(chart_name, {
    chart: {
        type: 'column'
    },
    title: {
        text: title_name[0]
    },
    credits:{
            enabled:false
    },
    exporting:{
    enabled:false,
    },
    xAxis: {
        type: 'category',
        labels: {
            rotation: -45  // 设置轴标签旋转角度
        }
    },
    yAxis: {
        min: 0,
        title: {
            text: title_name[1]
        }
    },
    legend: {
        enabled: false
    },
    tooltip: {
        pointFormat: '数量'
    },
    series: [{
        name: '总人口',
        data: [
            ['地区1', 24.25],
            ['地区2', 23.50],
            ['地区3', 21.51],
            ['地区4', 16.78],
            ['地区5', 16.06],
            ['地区6', 15.20],
            ['地区7', 14.16],
            ['地区8', 13.51],
            ['地区9', 13.08],
            ['地区10', 12.44],
            ['地区11', 12.19],
            ['地区12', 12.03],
            ['地区13', 10.46],
            ['地区14', 10.07],
            ['地区15', 10.05],

        ],
        dataLabels: {
            enabled: true,
            rotation: -90,
            color: '#FFFFFF',
            align: 'right',
            format: '{point.y:.1f}', // :.1f 为保留 1 位小数
            y: 10
        }
    }]
});
    }
    function his_chart_multi() {
        var chart = Highcharts.chart('chart2',{
    chart: {
        type: 'column'
    },
    title: {
        text: '月平均降雨量'
    },
    credits:{
            enabled:false
    },
    exporting:{
    enabled:false,
    },
    xAxis: {
        categories: [
            '一月','二月','三月','四月','五月','六月','七月','八月','九月','十月','十一月','十二月'
        ],
        crosshair: true
    },
    yAxis: {
        min: 0,
        title: {
            text: '降雨量 (mm)'
        }
    },
    tooltip: {
        // head + 每个 point + footer 拼接成完整的 table
        headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
        pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
        '<td style="padding:0"><b>{point.y:.1f} mm</b></td></tr>',
        footerFormat: '</table>',
        shared: true,
        useHTML: true
    },
    plotOptions: {
        column: {
            borderWidth: 0
        }
    },
    series: [{
        name: '东京',
        data: [49.9, 71.5, 106.4, 129.2, 144.0, 176.0, 135.6, 148.5, 216.4, 194.1, 95.6, 54.4]
    }, {
        name: '纽约',
        data: [83.6, 78.8, 98.5, 93.4, 106.0, 84.5, 105.0, 104.3, 91.2, 83.5, 106.6, 92.3]
    }, {
        name: '伦敦',
        data: [48.9, 38.8, 39.3, 41.4, 47.0, 48.3, 59.0, 59.6, 52.4, 65.2, 59.3, 51.2]
    }, {
        name: '柏林',
        data: [42.4, 33.2, 34.5, 39.7, 52.6, 75.5, 57.4, 60.4, 47.6, 39.1, 46.8, 51.1]
    }]
});
    }
    function line_chart(chart_data,chart_name,title_name){
        var chart = Highcharts.chart(chart_name, {
    title: {
        text: title_name
    },
    yAxis: {
        title: {
            text: '案件数量'
        }
    },
    credits:{
            enabled:false
    },
    exporting:{
    enabled:false,
    },
    legend: {
        layout: 'vertical',
        align: 'right',
        verticalAlign: 'middle'
    },
    xAxis:{
           categories:chart_data[0],
    },
    series: chart_data[1],
    responsive: {
        rules: [{
            condition: {
                maxWidth: 500
            },
            chartOptions: {
                legend: {
                    layout: 'horizontal',
                    align: 'center',
                    verticalAlign: 'bottom'
                }
            }
        }]
    }
});
    }
    function line_chart_dynamic(data) {
        var chart = null;

    {#console.log(data)#}
    chart = Highcharts.chart('chart6', {
        chart: {
            zoomType: 'x'
        },
        title: {
            text: '收结案预测'
        },
    credits:{
            enabled:false
    },
    exporting:{
    enabled:false,
    },
        xAxis: {
            type: 'datetime',
            dateTimeLabelFormats: {
                millisecond: '%H:%M:%S.%L',
                second: '%H:%M:%S',
                minute: '%H:%M',
                hour: '%H:%M',
                day: '%m-%d',
                week: '%m-%d',
                month: '%Y-%m',
                year: '%Y'
            }
        },
        tooltip: {
            dateTimeLabelFormats: {
                millisecond: '%H:%M:%S.%L',
                second: '%H:%M:%S',
                minute: '%H:%M',
                hour: '%H:%M',
                day: '%Y-%m-%d',
                week: '%m-%d',
                month: '%Y-%m',
                year: '%Y'
            }
        },
        yAxis: {
            title: {
                text: '数量'
            }
        },
        legend: {
            enabled: false
        },
        plotOptions: {
            area: {
                fillColor: {
                    linearGradient: {
                        x1: 0,
                        y1: 0,
                        x2: 0,
                        y2: 1
                    },
                    stops: [
                        [0, new Highcharts.getOptions().colors[0]],
                        [1, new Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
                    ]
                },
                marker: {
                    radius: 2
                },
                lineWidth: 1,
                states: {
                    hover: {
                        lineWidth: 1
                    }
                },
                threshold: null
            }
        },
        series: [{
            type: 'area',
            name: '',
            data: data
        }]
    });
    }

    function his_chart_row() {
        var categories = ['0-4', '5-9', '10-14', '15-19',
                  '20-24', '25-29', '30-34', '35-39', '40-44',
                  '45-49', '50-54', '55-59', '60-64', '65-69',
                  '70-74', '75-79', '80-84', '85-89', '90-94',
                  '95-99', '100 + '];
var chart = Highcharts.chart('chart4-2', {
    chart: {
        type: 'bar'
    },
    title: {
        text: '案件数量'
    },
    credits:{
            enabled:false
    },
    exporting:{
    enabled:false,
    },
    xAxis: [{
        categories: categories,
        reversed: false,
        labels: {
            step: 1
        }
    }, {
        // 显示在右侧的镜像 xAxis （通过 linkedTo 与第一个 xAxis 关联）
        opposite: true,
        reversed: false,
        categories: categories,
        linkedTo: 0,
        labels: {
            step: 1
        }
    }],
    yAxis: {
        title: {
            text: null
        },
        labels: {
            formatter: function () {
                return (Math.abs(this.value) / 1000000) + 'M';
            }
        },
        min: -4000000,
        max: 4000000
    },
    plotOptions: {
        series: {
            stacking: 'normal'
        }
    },
    tooltip: {
        formatter: function () {
            return '<b>' + this.series.name + ', age ' + this.point.category + '</b><br/>' +
                '人口: ' + Highcharts.numberFormat(Math.abs(this.point.y), 0);
        }
    },
    series: [{
        name: 'XX案件',
        data: [-1746181, -1884428, -2089758, -2222362, -2537431, -2507081, -2443179,
               -2664537, -3556505]
    }, {
        name: 'XX案件',
        data: [1656154, 1787564, 1981671, 2108575, 2403438, 2366003, 2301402, 2519874,
               3360596, 3493473]
    }]
});
    }
    function html_put(chart_name,chart_text) {
        $(chart_name).empty();
        html = chart_text

    }
    function prediction(name,data) {
        var prediction_data;
        var range;

        {#range = data.length;#}
        prediction_data = data[40][1];
        {#alert(name,range);#}
        $(name).text('预测结果:\n'+prediction_data);
        {#console.log(prediction_data)#}
    }
    pie_chart();
    his_chart_multi();
    his_chart('chart4-1',['案件数量','数量']);
    his_chart_row();
    line_chart({{ line_data.0 | safe }},'chart5-1','收案数量');
    line_chart({{ line_data.1 | safe }},'chart5-2','结案数量');
    line_chart_dynamic({{ test.line_data.0 |safe }})
    </script>
{% endblock %}